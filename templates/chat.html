<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>–û–Ω–ª–∞–π–Ω-–º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      -webkit-tap-highlight-color: transparent;
      background-color: #f1f5f9;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    .msg-bubble {
      max-width: 80%;
      word-wrap: break-word;
      border-radius: 18px;
      padding: 8px 14px;
    }
    .self {
      background-color: #007aff;
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }
    .other {
      background-color: #e5e7eb;
      color: black;
      margin-right: auto;
      border-bottom-left-radius: 4px;
    }
  </style>
</head>

<body class="flex flex-col h-screen bg-slate-100">
  <!-- –®–∞–ø–∫–∞ -->
  <div class="bg-blue-600 text-white text-center py-3 text-lg font-semibold">
    üí¨ –û–Ω–ª–∞–π–Ω-—á–∞—Ç
  </div>

  <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
  <div id="messages" class="flex-1 overflow-y-auto p-3 flex flex-col space-y-2"></div>

  <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
  <div class="p-3 bg-white border-t flex items-center">
    <input id="msgInput" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."
           class="flex-1 border rounded-full px-4 py-2 focus:outline-none" />
    <button id="sendBtn"
            class="ml-2 bg-blue-500 text-white rounded-full px-4 py-2 active:scale-95 transition">
      ‚û§
    </button>
  </div>

  <!-- –°–∫—Ä–∏–ø—Ç —á–∞—Ç–∞ -->
  <script>
    const socket = io();
    const username = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è:") || "–ê–Ω–æ–Ω–∏–º";

    socket.emit('join', { username });

    const messages = document.getElementById('messages');
    const input = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
    function appendMessage(user, text, time, self=false) {
      const div = document.createElement('div');
      div.className = 'msg-bubble ' + (self ? 'self' : 'other');
      div.innerHTML = `<b>${user}</b> <small class="opacity-70">${time || ''}</small><br>${text}`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –∏–ª–∏ Enter
    sendBtn.onclick = sendMsg;
    input.addEventListener('keydown', e => { if (e.key === 'Enter') sendMsg(); });

    function sendMsg() {
      const text = input.value.trim();
      if (!text) return;
      const time = new Date().toLocaleTimeString().slice(0,5);
      appendMessage(username, text, time, true);
      socket.emit('chat_message', { text });
      input.value = '';
    }

    // –ü—Ä–∏—ë–º —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
    socket.on('message', data => {
      const self = data.user === username;
      appendMessage(data.user, data.text, data.time, self);
    });
  </script>
</body>
</html>
