<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–û–Ω–ª–∞–π–Ω-—á–∞—Ç</title>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .msg-bubble { max-width: 80%; word-wrap: break-word; border-radius: 18px; padding: 8px 14px; }
    .self { background-color: #007aff; color: white; margin-left: auto; border-bottom-right-radius: 4px; }
    .other { background-color: #e5e7eb; color: black; margin-right: auto; border-bottom-left-radius: 4px; }
  </style>
</head>
<body class="flex flex-col h-screen bg-slate-100">

  <div class="bg-blue-600 text-white text-center py-3 text-lg font-semibold">
    üí¨ –û–Ω–ª–∞–π–Ω-—á–∞—Ç
  </div>

  <div id="messages" class="flex-1 overflow-y-auto p-3 flex flex-col space-y-2"></div>

  <div class="p-3 bg-white border-t flex">
    <input id="msgInput" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." class="flex-1 border rounded-full px-4 py-2 focus:outline-none" />
    <button id="sendBtn" class="ml-2 bg-blue-500 text-white rounded-full px-4 py-2">‚û§</button>
  </div>

  <script>
    const socket = io();
    const username = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è:") || "–ê–Ω–æ–Ω–∏–º";

    socket.emit('join', { username });

    const messages = document.getElementById('messages');
    const input = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');

    function appendMessage(user, text, time, self=false) {
      const div = document.createElement('div');
      div.className = 'msg-bubble ' + (self ? 'self' : 'other');
      div.innerHTML = `<b>${user}</b> <small class="opacity-70">${time || ''}</small><br>${text}`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    sendBtn.onclick = sendMsg;
    input.addEventListener('keydown', e => { if (e.key === 'Enter') sendMsg(); });

    function sendMsg() {
      const text = input.value.trim();
      if (!text) return;
      const time = new Date().toLocaleTimeString().slice(0,5);
      appendMessage(username, text, time, true);
      socket.emit('chat_message', { text });
      input.value = '';
    }

    socket.on('message', data => {
      const self = data.user === username;
      appendMessage(data.user, data.text, data.time, self);
    });
  </script>

</body>
</html>
